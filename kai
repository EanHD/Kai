#!/bin/bash
# Kai CLI entry point with dependency checks

set -e  # Exit on any error

# Get absolute path to script directory (project root)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Change to project root
cd "$SCRIPT_DIR"

# Check if uv is available
if ! command -v uv &> /dev/null; then
    echo "❌ Error: 'uv' not found in PATH"
    echo ""
    echo "Install uv with:"
    echo "  curl -LsSf https://astral.sh/uv/install.sh | sh"
    echo ""
    echo "Or use python directly from project root:"
    echo "  cd '$SCRIPT_DIR' && python -m src.cli.main"
    exit 1
fi

# Check Ollama is running (suppress errors if pgrep not found)
if command -v pgrep &> /dev/null && ! pgrep -x "ollama" > /dev/null 2>&1; then
    echo "⚠ Warning: Ollama not running (required for local models)"
    echo "   Start with: ollama serve"
fi

# Run Kai with uv from project root
# Use absolute path to ensure uv finds the right pyproject.toml
exec uv run --directory "$SCRIPT_DIR" python -m src.cli.main "$@"
